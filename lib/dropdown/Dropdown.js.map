{"version":3,"sources":["../../dev/mtui/dropdown/Dropdown.jsx"],"names":["DropDown","props","state","show","visible","div","document","createElement","setAttribute","handler","mid","refBtn","Date","mark","setMid","_this","dom","getElementById","body","appendChild","render","getPlace","bind","callback","self","renderDiv","setState","showBack","closeBack","hoverHandler","trigger","showOrHide","prevProps","e","addEventListener","removeEventListener","MT_MS","removeNode","remove","unmountComponentAtNode","Component","btn","type","children","className","other","cName","push","c","join","handleClick","defaultProps","style"],"mappings":"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","file":"Dropdown.js","sourcesContent":["'use strict';\r\n\r\nimport React,  { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport DropModal from './DropModal';\r\nimport {position} from '../utils/offset';\r\nimport { clickBlank,  offClickBlank } from '../utils/triggerBlank';\r\n\r\nclass DropDown extends Component {\r\n\r\n    // 默认参数\r\n    static defaultProps = {\r\n        btn: <a>dropdown</a>, \r\n        style: {},  // modal的样式\r\n        visible: false,  // 框默认隐藏\r\n        showBack: null,  // 显示时候的回调\r\n        closeBack: null,  // 关闭时候的回调\r\n        trigger: 'hover' // 触发下拉的行为\r\n    }\r\n    \r\n    // 构造函数\r\n    constructor (props) {\r\n        super(props);\r\n        this.state = {\r\n            show: props.visible\r\n        };\r\n        this.div = document.createElement('div');\r\n        this.div.setAttribute('class', 'mt-div');\r\n        this.handler = null;\r\n        this.mid = null;\r\n\r\n        this.refBtn = null;\r\n    }\r\n\r\n    // 设置 mid\r\n    setMid() {\r\n        if(this.mid === null){\r\n            this.mid = 'mt_dropdown_' + +new Date();\r\n        }\r\n    }\r\n\r\n    getPlace(){\r\n        return position(this.refBtn);\r\n    }\r\n\r\n    // 渲染div\r\n    renderDiv( mark ){\r\n        this.setMid();\r\n        var _this = this;\r\n        var dom = document.getElementById(this.mid);\r\n        // 首次渲染即可\r\n        if(!dom || mark){\r\n            if( !mark ){\r\n                document.body.appendChild(this.div);\r\n            }\r\n            ReactDOM.render(<DropModal mid={this.mid}  getPlace={this.getPlace.bind(this)} show={this.state.show} {...this.props}/>, this.div);\r\n        }\r\n    }\r\n\r\n    // 隐藏显示\r\n    showOrHide(show, callback){\r\n        var self = this;\r\n        this.renderDiv();\r\n        this.setState({\r\n            show: !show\r\n        }, function(){\r\n            if(self.state.show && self.props.showBack){\r\n                self.props.showBack();\r\n            }else if(self.props.closeBack){\r\n                self.props.closeBack();\r\n            }\r\n            if(callback){\r\n                callback();\r\n            }\r\n        });\r\n        this.hoverHandler = null;\r\n    }\r\n\r\n    // 点击事件\r\n    handleClick(){\r\n        const self = this;\r\n        const show = this.state.show;\r\n        if(this.props.trigger === 'click'){\r\n            this.showOrHide(show,  function(){\r\n                if(self.handler){\r\n                    offClickBlank(self.handler);\r\n                }\r\n                self.handler = clickBlank(document.getElementById(self.mid), function(mark){\r\n                    if(!mark){\r\n                        self.showOrHide(true);\r\n                        offClickBlank(self.handler);\r\n                    }\r\n                });\r\n            });\r\n        }else{\r\n            return;\r\n        }\r\n    }\r\n\r\n    // 更新弹窗里面的数据\r\n    componentDidUpdate(prevProps){\r\n        if(document.getElementById(this.mid)){\r\n            this.renderDiv(true);\r\n        }\r\n    }\r\n\r\n    // 初始化状态\r\n    componentDidMount() {\r\n\r\n        // 如果默认是显示，直接显示DIV\r\n        if(this.props.visible){\r\n            this.renderDiv();\r\n        }\r\n\r\n        // hover事件\r\n        if(this.props.trigger === 'hover'){\r\n            const self = this;\r\n\r\n            this.hoverHandler = function(e){\r\n                self.showOrHide(false, function(){\r\n                    if(self.handler){\r\n                        offClickBlank(self.handler, 'mousemove');\r\n                    }\r\n                    self.handler = clickBlank(document.getElementById(self.mid), function(mark){\r\n                        if(!mark){\r\n                            self.showOrHide(true, null);\r\n                            offClickBlank(self.handler, 'mousemove');\r\n                        }\r\n                    }, 'mousemove', self.refBtn);\r\n                });\r\n            };\r\n            this.refBtn.addEventListener('mouseover', this.hoverHandler);\r\n        }\r\n    }\r\n\r\n    // 卸载组件\r\n    componentWillUnmount() {\r\n        if(this.props.trigger === 'hover'){\r\n            offClickBlank(this.handler, 'mousemove');\r\n        }else{\r\n            offClickBlank(this.handler);\r\n        }\r\n        this.refBtn.removeEventListener('mouseover', this.hoverHandler);\r\n        if(MT_MS === 'IE') {\r\n            this.div.removeNode(true);\r\n        }else{\r\n            this.div.remove();\r\n        }\r\n        ReactDOM.unmountComponentAtNode(this.div);\r\n    }\r\n\r\n    render(){\r\n        var Component = this.props.btn.type;\r\n        var {children, className,  ...other} = this.props.btn.props;\r\n        var cName = ['mt-dropdown-btn'];\r\n        if(className){\r\n            cName.push(className);\r\n        }\r\n        return <Component ref={ (c) => { this.refBtn = c; }} className={cName.join(' ')} onClick={this.handleClick.bind(this)} {...other}>{children}</Component>;\r\n    }\r\n}\r\n\r\n// 主页\r\nexport default DropDown;"]}